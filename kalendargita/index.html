<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalendar Mood Gita</title>
<style>
  :root{
    --bg:#0b0c10; --card:#121318; --muted:#9aa3b2; --text:#e8edf2; --accent:#5ad1ff;
    --haid:#ff4d6d; --pasca:#42c7b2; --pra:#7dcfff; --ovul:#ffb000; --luteal:#b388ff; --pms:#ff89b5;
    --border:#1e2230; --highlight:#2a3042;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0b0c10 0%, #0d1117 100%);color:var(--text)}
  .wrap{max-width:1100px;margin:24px auto;padding:16px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
  h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.2px}
  .controls{display:flex;gap:8px;align-items:center}
  button,select{background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
  button:hover{background:var(--highlight);cursor:pointer}
  .legend{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 18px}
  .chip{display:flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--card);padding:6px 10px;border-radius:999px;font-size:12px}
  .dot{width:12px;height:12px;border-radius:50%}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;border-top:1px solid var(--border);padding-top:10px}
  .dow{font-size:12px;color:var(--muted);text-align:center;padding:8px 0}
  .day{background:var(--card);border:1px solid var(--border);min-height:96px;border-radius:12px;padding:8px;position:relative;transition:transform .08s ease}
  .day:hover{transform:translateY(-1px)}
  .date{font-size:12px;color:var(--muted)}
  .badge{position:absolute;right:8px;top:6px;font-size:18px}
  .phase{margin-top:8px;font-size:12px;font-weight:600}
  .note{margin-top:4px;font-size:12px;color:var(--muted);line-height:1.3}
  .empty{background:transparent;border:none}
  .is-weekend{outline:1px dashed #2f364a}
  .col-haid{background:linear-gradient(180deg,#1a0c12, #16070b);box-shadow:inset 0 0 0 1px rgba(255,77,109,.25)}
  .col-pasca{background:linear-gradient(180deg,#0c1514,#0b1312);box-shadow:inset 0 0 0 1px rgba(66,199,178,.25)}
  .col-pra{background:linear-gradient(180deg,#0b1420,#0a111a);box-shadow:inset 0 0 0 1px rgba(125,207,255,.25)}
  .col-ovul{background:linear-gradient(180deg,#201609,#19100a);box-shadow:inset 0 0 0 1px rgba(255,176,0,.35)}
  .col-luteal{background:linear-gradient(180deg,#1a1324,#141024);box-shadow:inset 0 0 0 1px rgba(179,136,255,.28)}
  .col-pms{background:linear-gradient(180deg,#1e0e19,#160b14);box-shadow:inset 0 0 0 1px rgba(255,137,181,.28)}
  .monthbar{display:flex;align-items:center;gap:10px;margin:10px 0 14px}
  .tip{font-size:12px;color:var(--muted)}
  .panel{margin-top:14px;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .linklike{color:var(--accent);text-decoration:none;border:1px solid var(--border);padding:8px 10px;border-radius:10px;background:#0d121a}
  .tooltip{position:absolute;left:8px;bottom:8px;background:#10131a;border:1px solid var(--border);padding:8px 10px;border-radius:10px;font-size:12px;color:var(--muted);display:none;max-width:240px}
  .day:hover .tooltip{display:block}
  @media (max-width:720px){
    .day{min-height:88px}
    .note{display:none}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Kalendar Mood Gita</h1>
    <div class="controls">
      <button id="prevBtn" aria-label="Bulan sebelumnya">‚üµ</button>
      <select id="monthPicker" aria-label="Pilih bulan"></select>
      <button id="nextBtn" aria-label="Bulan berikutnya">‚ü∂</button>
    </div>
  </header>

  <div class="legend">
    <span class="chip"><span class="dot" style="background:var(--haid)"></span>üåô Haid</span>
    <span class="chip"><span class="dot" style="background:var(--pasca)"></span>üå§ Pasca Haid</span>
    <span class="chip"><span class="dot" style="background:var(--pra)"></span>üå∏ Pra-Ovulasi</span>
    <span class="chip"><span class="dot" style="background:var(--ovul)"></span>üî• Ovulasi</span>
    <span class="chip"><span class="dot" style="background:var(--luteal)"></span>Luteal Awal</span>
    <span class="chip"><span class="dot" style="background:var(--pms)"></span>üåß Luteal Akhir / PMS</span>
  </div>

  <div class="monthbar">
    <div class="tip">Rentang: <strong>Nov 2025 ‚Äì Nov 2026</strong> ‚Ä¢ Siklus: <strong>32 hari</strong> ‚Ä¢ Hari 1: <strong>6 Nov 2025</strong> (Asia/Jakarta)</div>
  </div>

  <div id="calendar" class="grid" aria-live="polite"></div>

  <div class="panel">
    <strong>Download ICS</strong>
    <div class="actions">
      <a href="#" id="dlIcsAll" class="linklike">‚¨áÔ∏è Semua hari (rentang)</a>
      <a href="#" id="dlIcsMonth" class="linklike">‚¨áÔ∏è Hanya bulan ini</a>
    </div>
    <div class="tip">Event bernama <code>‚ù§Ô∏è + emoji mood</code> dengan deskripsi lengkap (fase, hari ke-, mood, kondisi, tips).</div>
  </div>
</div>

<script>
/* =======================
   CONFIG
   ======================= */
const CONFIG = {
  startDate: new Date(Date.UTC(2025,10,6)), // 6 Nov 2025 (Day 1)
  endDate:   new Date(Date.UTC(2026,10,30)),// 30 Nov 2026
  cycleLen:  32,
  tz: "Asia/Jakarta",
  rangeMonths: (()=>{
    const arr=[], start={y:2025,m:10}, end={y:2026,m:10};
    let y=start.y, m=start.m;
    while(y<end.y || (y===end.y && m<=end.m)){
      arr.push({y,m}); m++; if(m>11){m=0;y++;}
    } return arr;
  })()
};

/* =======================
   Phase / mood mapping
   ======================= */
function phaseAndMood(day){
  if(day>=1 && day<=5) return {phase:"Haid", mood:"Butuh perhatian, mellow, ingin dimanja", emoji:"üåô", cls:"col-haid", color:"var(--haid)"};
  if(day>=6 && day<=10) return {phase:"Pasca Haid", mood:"Mood stabil, cerah", emoji:"üå§", cls:"col-pasca", color:"var(--pasca)"};
  if(day>=11 && day<=16) return {phase:"Pra-Ovulasi", mood:"Ceria, aktif, percaya diri", emoji:"üå∏", cls:"col-pra", color:"var(--pra)"};
  if(day>=17 && day<=21) return {phase:"Ovulasi", mood:"Libido tinggi, playful, ekspresif", emoji:"üî•", cls:"col-ovul", color:"var(--ovul)"};
  if(day>=22 && day<=27) return {phase:"Luteal Awal", mood:"Romantis, hangat, stabil", emoji:"üíú", cls:"col-luteal", color:"var(--luteal)"};
  return {phase:"Luteal Akhir / PMS", mood:"Clingy, moody, craving comfort", emoji:"üåß", cls:"col-pms", color:"var(--pms)"};
}
function conditionByPhase(p){
  if(p==="Haid") return "Lemas, nyeri ringan, hormon rendah";
  if(p==="Pasca Haid") return "Energi naik & stabil";
  if(p==="Pra-Ovulasi") return "Estrogen meningkat, tubuh aktif";
  if(p==="Ovulasi") return "Estrogen & LH puncak, tubuh fit";
  if(p==="Luteal Awal") return "Progesteron naik, romantis";
  return "Hormon turun, mood swing";
}
function tipByPhase(p){
  if(p==="Haid") return "Kasih perhatian, peluk, bantu istirahat.";
  if(p==="Pasca Haid") return "Ajak aktivitas ringan / ngobrol santai.";
  if(p==="Pra-Ovulasi") return "Beri pujian & quality time.";
  if(p==="Ovulasi") return "Waktu terbaik untuk kedekatan & keintiman.";
  if(p==="Luteal Awal") return "Momen romantis, tenang, hangat.";
  return "Jangan debat; kasih comfort & sabar.";
}

/* =======================
   Helpers
   ======================= */
const idDays = ["Sen","Sel","Rab","Kam","Jum","Sab","Min"];
function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
function clampToRange(d){ if(d<CONFIG.startDate||d>CONFIG.endDate) return null; return d; }
function cycleDayOf(date){
  const diffDays = Math.floor((Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()) - Date.UTC(CONFIG.startDate.getFullYear(),CONFIG.startDate.getMonth(),CONFIG.startDate.getDate()))/86400000);
  const cd = ((diffDays % CONFIG.cycleLen)+CONFIG.cycleLen)%CONFIG.cycleLen;
  return cd + 1;
}

/* =======================
   Calendar rendering
   ======================= */
const calEl = document.getElementById("calendar");
const monthPicker = document.getElementById("monthPicker");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

// Fill month picker
CONFIG.rangeMonths.forEach(({y,m},idx)=>{
  const o=document.createElement("option");
  o.value=String(idx);
  o.textContent=new Date(y,m,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"});
  monthPicker.appendChild(o);
});
// Default current month in range
let currentIdx = (()=>{ const now=new Date(); const i=CONFIG.rangeMonths.findIndex(({y,m})=>y===now.getFullYear()&&m===now.getMonth()); return i>=0?i:0; })();
monthPicker.value = String(currentIdx);

function renderMonthByIndex(idx){
  calEl.innerHTML="";
  const {y,m} = CONFIG.rangeMonths[idx];
  const headers = ["Sen","Sel","Rab","Kam","Jum","Sab","Min"];
  headers.forEach(h=>{ const d=document.createElement("div"); d.className="dow"; d.textContent=h; calEl.appendChild(d); });
  const firstDow = (new Date(y,m,1).getDay()+6)%7; // Mon=0..Sun=6
  for(let i=0;i<firstDow;i++){ const cell=document.createElement("div"); cell.className="day empty"; calEl.appendChild(cell); }

  const nDays = new Date(y,m+1,0).getDate();
  for(let dt=1; dt<=nDays; dt++){
    const d = new Date(y,m,dt);
    const cell=document.createElement("div");
    cell.className="day";
    if([6,0].includes(d.getDay())) cell.classList.add("is-weekend");

    let inner = `<div class="date">${dt} ${headers[(d.getDay()+6)%7]}</div>`;
    const inRange = clampToRange(d);

    if(inRange){
      const cd = cycleDayOf(d);
      const {phase, mood, emoji, cls} = phaseAndMood(cd);
      cell.classList.add(cls);
      inner += `<div class="badge" aria-hidden="true">‚ù§Ô∏è ${emoji}</div>`;
      inner += `<div class="phase">${phase}</div>`;
      inner += `<div class="note">${mood}</div>`;
      inner += `<div class="tooltip">Hari ke-${cd} ‚Ä¢ ${conditionByPhase(phase)}<br/>Tips: ${tipByPhase(phase)}</div>`;
      cell.onclick = ()=> showDetail(d, cd, phase, mood, emoji);
      cell.onkeyup = (e)=>{ if(e.key==="Enter") cell.click(); };
    } else {
      inner += `<div class="note">Di luar rentang</div>`;
    }

    cell.innerHTML = inner;
    calEl.appendChild(cell);
  }
}
function showDetail(date, cd, phase, mood, emoji){
  const pretty = date.toLocaleDateString("id-ID",{weekday:"long", day:"2-digit", month:"long", year:"numeric"});
  const panel = document.querySelector(".panel");
  panel.scrollIntoView({behavior:"smooth",block:"nearest"});
  panel.querySelector("strong").textContent = `Detail ‚Ä¢ ${pretty}`;
  const tip = tipByPhase(phase);
  const cond = conditionByPhase(phase);
  panel.querySelector(".tip").innerHTML = `
    <div style="margin-top:6px">
      <div><b>Judul event:</b> ‚ù§Ô∏è ${emoji}</div>
      <div><b>Fase:</b> ${phase} ‚Ä¢ <b>Hari ke-</b>${cd}</div>
      <div><b>Mood:</b> ${mood}</div>
      <div><b>Kondisi fisik:</b> ${cond}</div>
      <div><b>Tips:</b> ${tip}</div>
    </div>
  `;
}
renderMonthByIndex(currentIdx);
prevBtn.onclick = ()=>{ if(currentIdx>0){ currentIdx--; monthPicker.value=String(currentIdx); renderMonthByIndex(currentIdx);} };
nextBtn.onclick = ()=>{ if(currentIdx<CONFIG.rangeMonths.length-1){ currentIdx++; monthPicker.value=String(currentIdx); renderMonthByIndex(currentIdx);} };
monthPicker.onchange = (e)=>{ currentIdx = parseInt(e.target.value,10); renderMonthByIndex(currentIdx); };

/* =======================
   ICS GENERATION (ALL DAYS)
   ======================= */
function buildIcs(events, calName="Mood Gita"){
  const esc = s => s.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;");
  const pad = n => String(n).padStart(2,"0");
  const lines = [
    "BEGIN:VCALENDAR","VERSION:2.0","CALSCALE:GREGORIAN","PRODID:-//Mood Gita//ID",`X-WR-CALNAME:${esc(calName)}`
  ];
  const now = new Date();
  const dtstamp = `${now.getUTCFullYear()}${pad(now.getUTCMonth()+1)}${pad(now.getUTCDate())}T${pad(now.getUTCHours())}${pad(now.getUTCMinutes())}${pad(now.getUTCSeconds())}Z`;
  events.forEach(ev=>{
    const dt = `${ev.date.getFullYear()}${pad(ev.date.getMonth()+1)}${pad(ev.date.getDate())}`;
    const end = new Date(ev.date); end.setDate(end.getDate()+1);
    const dtend = `${end.getFullYear()}${pad(end.getMonth()+1)}${pad(end.getDate())}`;
    const desc = [
      `üìÖ Tanggal: ${ev.date.toLocaleDateString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`,
      `üîÑ Hari ke- dalam siklus: ${ev.cycleDay}`,
      `üí´ Fase: ${ev.phase}`,
      `üß† Mood & perilaku: ${ev.mood}`,
      `üìä Kondisi fisik: ${conditionByPhase(ev.phase)}`,
      `‚ù§Ô∏è Tips: ${tipByPhase(ev.phase)}`,
      `üåê Zona waktu: ${CONFIG.tz}`
    ].join("\\n");
    lines.push("BEGIN:VEVENT");
    lines.push(`UID:${randomUID()}@mood-gita`);
    lines.push(`DTSTAMP:${dtstamp}`);
    lines.push(`DTSTART;VALUE=DATE:${dt}`);
    lines.push(`DTEND;VALUE=DATE:${dtend}`);
    lines.push(`SUMMARY:${esc("‚ù§Ô∏è " + ev.emoji)}`);
    lines.push(`DESCRIPTION:${desc}`);
    lines.push("END:VEVENT");
  });
  lines.push("END:VCALENDAR");
  return lines.join("\n");
}
function randomUID(){return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);});}
function collectEvents(range){
  const list=[];
  let d = new Date(range.start.getFullYear(), range.start.getMonth(), 1);
  const endLast = new Date(range.end.getFullYear(), range.end.getMonth()+1, 0);
  while(d <= endLast){
    const inside = clampToRange(d);
    if(inside){
      const cd = cycleDayOf(d);
      const {phase,mood,emoji} = phaseAndMood(cd);
      list.push({date:new Date(d), cycleDay:cd, phase, mood, emoji});
    }
    d = addDays(d,1);
  }
  return list;
}
function download(filename, text){
  const blob = new Blob([text], {type:"text/calendar;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url; a.download = filename; a.click();
  setTimeout(()=> URL.revokeObjectURL(url), 1500);
}
document.getElementById("dlIcsAll").onclick = (e)=>{
  e.preventDefault();
  const evs = collectEvents({start:new Date(CONFIG.rangeMonths[0].y,CONFIG.rangeMonths[0].m,1), end:new Date(CONFIG.rangeMonths.at(-1).y, CONFIG.rangeMonths.at(-1).m+1,0)});
  const ics = buildIcs(evs, "Mood Gita (Semua Hari)");
  download("Mood_Gita_All.ics", ics);
};
document.getElementById("dlIcsMonth").onclick = (e)=>{
  e.preventDefault();
  const {y,m} = CONFIG.rangeMonths[currentIdx];
  const evs = collectEvents({start:new Date(y,m,1), end:new Date(y,m+1,0)});
  const name = new Date(y,m,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"});
  const ics = buildIcs(evs, `Mood Gita (${name})`);
  download(`Mood_Gita_${name.replace(/\s/g,'_')}.ics`, ics);
};
</script>
</body>
</html>
